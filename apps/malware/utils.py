from dns import message, query
from dns.exception import DNSException
from datetime import datetime

def query_mhr(hash):
    query_string = "%s.malware.hash.cymru.com" % hash
    try:
        q = message.make_query(query_string, 'TXT')
        d = query.udp(q, '130.237.72.200', timeout=5)
        if d.answer:
            for n in d.answer:
                result = str(n).split("\"")[1]
                unixtime = result.split()[0]
                percent = result.split()[1]
                dt = datetime.fromtimestamp(float(unixtime))
                return dt, percent
        else:
            return None, None
    except DNSException:
        return None, None