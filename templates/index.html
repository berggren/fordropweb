{% extends "base.html" %}
{% load thumbnail %}
{% load comments %}
{% load threadedcomments_tags %}

{% block menu %}
<div id="navcontainer">
	<ul id="navlist">
		<li id="active"><a href="/" id="current"><h1 class="menu"><br>Home</h1><p class="menu">My place</p></a></li>
		<li><a href="/upload"><h1 class="menu"><br>Upload & Report</h1><p class="menu">Share</p></a></li>
		<li><a href="/investigation"><h1 class="menu"><br>Investigations</h1><p class="menu">Collaborate</p></a></li>
	</ul>
</div>
{% endblock %}

{% block content %}
<div id="rightbox">
  <br>
  <h1 class="big">{{ user.get_full_name }}</h1>
  <div class="avatar"><img class="avatar-thumb" src={% thumbnail user.get_profile.avatar 80x80 crop %}></div>

  <span class="threadText">
    email: jbn@kth.se<br>
    telephone: 08555555<br>
    twitter: crapp<br>
    organisation: kth.se
  </span>

</div>

<div id="breadcrumbs"> 
  <br>
  <ul> 
    <li><span>Home</span></li> 
  </ul> 
	<hr>
<!--
<div id="navlist2">
<ul>
  <li id="active"><a href="#" id="current">Overview</a></li>
  <li><a href="#">My investigations</a></li>
  <li><a href="#">Todo</a></li>
  <li><a href="#">Browse</a></li>
  <li><a href="#">Profile</a></li>
</ul>
</div>
-->

</div>
 

<div id="middlebox">


  <div id="streambox">
	<h1>My investigations</h1>
	<div class="news_box_grey">
    {% for investigation in investigations|dictsortreversed:"lastupdated"|slice:"3" %}
      <a href="/investigation/{{ investigation.id }}">
		  <div class="news-title">{{ investigation.title }}</div>
		  {% if investigation.description %}
        <span class="threadTextDarker">
			   <i>
          {{ investigation.description.content|linebreaksbr|truncatewords:"50" }}
			   </i>
		    </span>
		    <br>
		  {% endif %}
		  <span class="threadText">Last activity was {{ investigation.lastupdated|timesince }} ago</span>
		  <br>
		  <br>
		  </a>
    {% endfor %}
  </div>
   </div>

  <div id="todobox">
	 <h1>Stream</h1>
	 {% for item in stream|dictsortreversed:"time"|slice:"5" %}
		<div class="post_container">
			{% ifequal item.type "comment" %}
				<div class="avatar"><img class="avatar-thumb" src="{% thumbnail item.object.user.get_profile.avatar 40x40 crop %}"></div>
				<div class="post_box">
	  				<span class="threadTitle"><a href="/user/{{ item.object.user.id }}">{{ item.object.user.first_name }} {{ item.object.user.last_name }}</a></span>
					{% ifequal item.object.content_type.name "file" %}
	    				commented on {{ item.object.content_type }}<a href="/file/{{ item.object.content_object.id }}/show"> #{{ item.object.content_object.id }}, </a>
					{% endifequal %}
					{% ifequal item.object.content_type.name "user" %}
						to <a href="/file/{{ item.object.content_object.id }}/show">{{ item.object.content_object.get_full_name }},</a></span>
					{% endifequal %}
					{% ifequal item.object.content_type.name "report" %}
						<span class="threadText">
							<i><a href="/report/{{ item.object.content_object.id }}/show">{{ item.object.content_object.sha1 }}</a></i>
						</span>
					{% endifequal %}
					{% ifequal item.object.content_type.name "tag" %}
						<span class="threadText">
							<i>{{ item.object.content_object }}</i>
						</span>
					{% endifequal %} 
				    <font color="#222">{{ item.object.comment|linebreaksbr|truncatewords:"30" }}</font>
					<br>
					<span class="threadText">{{ item.object.submit_date|timesince }} ago</span>
				 </div>
			{% endifequal %}
			{% ifequal item.type "file" %}
				<div class="avatar"><img class="avatar-thumb" src={% thumbnail item.object.user.get_profile.avatar 40x40 crop %}></div>
				<div class="post_box">
					<span class="threadTitle"><a href="/user/{{ item.object.user.id }}">{{ item.object.user.first_name }} {{ item.object.user.last_name }}</a></span> 
					uploaded file {{ item.object.filename }} with a filetype of {{ item.object.file.filetype }}
					<br>
					<span class="threadText">{{ item.object.timecreated|timesince }}</span>
				</div>
			{% endifequal %}
			{% ifequal item.type "report" %}
				<div class="avatar"><img class="avatar-thumb" src={% thumbnail item.object.user.get_profile.avatar 40x40 crop %}></div>
				<div class="post_box">
				    <span class="threadTitle"><a href="/user/{{ item.object.user.id }}">{{ item.object.user.first_name }} {{ item.object.user.last_name }}</a></span> 
					reported {{ item.object.report.type }}, {{ item.object.report.value }}
				</div>
				<span class="threadText">{{ item.object.timecreated|timesince }} ago</span>
			{% endifequal %}
		</div>
	 {% endfor %}
  </div>

  <div id="streambox">
<br><br>
				<h1>News</h1>
					<div id="news">
					{% for item in news|slice:":7"  %}
						<div class="news_box">
							<div class="news-title">{{ item.title|slice:":50" }} ...</div>
							<span class="threadTextDarker">
								<i>
									{{ item.summary_detail.value|striptags|truncatewords:"30" }}
								</i>
							</span>
							<br>
							<span class="threadText">Sans Institue </span><span class="threadText"> | {{ user.last_login|timesince }} ago</span>
					 </div>
					{% endfor %}
  </div>
</div>

  <div id="todobox">
<br>
        <h1>News</h1>
          <div id="news">
          {% for item in news|slice:":7"  %}
            <div class="news_box">
              <div class="news-title">{{ item.title|slice:":50" }} ...</div>
              <span class="threadTextDarker">
                <i>
                  {{ item.summary_detail.value|striptags|truncatewords:"30" }}
                </i>
              </span>
              <br>
              <span class="threadText">Sans Institue </span><span class="threadText"> | {{ user.last_login|timesince }} ago</span>
           </div>
          {% endfor %}
  </div>
</div>


<br clear="all">
</div>

{% endblock %}