{% extends "apps/investigation/base.html" %}
{% load thumbnail %}
{% load comments %}

{% block menu %}
<div id="navcontainer">
  <ul id="navlist">
    <li><a href="/"><h1 class="menu"><br>Home</h1><p class="menu">My place</p></a></li>
    <li><a href="/upload"><h1 class="menu"><br>Upload & Report</h1><p class="menu">Share</p></a></li>
    <li id="active"><a id="current" href="/investigation"><h1 class="menu"><br>Investigations</h1><p class="menu">Collaborate</p></a></li>
  </ul>
</div>
{% endblock %}


{% block content %}

<div id="rightbox">
  <br>
  <h1>Authors</h1>  
  <img class="avatar-shadow" src={% thumbnail page.creator.get_profile.avatar 50x50 crop %}>
  <br><br><hr><br>

  <h1>Tags</h1>
  {% for tag in tags %}<i><a href="/search/tag?t={{ tag.id }}">{{ tag }}</a></i> {% endfor %}
  <form action="/tag/add/page/{{ page.id }}" method="post" enctype="multipart/form-data" width="450px">{% csrf_token %}
    {% for field in tagform %}
      {{ field.errors }}
      {{ field }}
    {% endfor %}
    <input type="submit" value="Add tag" />
  </form>

<h1>Pages</h1>
  <ul>
    {% for page in investigation.pages.all %}
      <li><a href="/investigation/{{ investigation.id }}/page/{{ page.id }}">{{ page.title }}</a></li>
    {% endfor %}
  </ul>
  <br>
  <span class="add-page"><a href="/investigation/{{ investigation.id }}/page/create">Create new page</a></span>


</div>

<div id="breadcrumbs"> 
  <ul> 
    <br>
    <li class="breadcrumblink"><a href="/investigation">Investigations</a></li>
    <li class="breadcrumblink"><a href="/investigation/{{ investigation.id }}">{{ investigation.title }}</a></li>
    <li class="breadcrumblink"><a href="/investigation/{{ investigation.id }}/library">Library</a></li>
    <li><span>{{ page.title }}</span></li>
  </ul> 
  <hr>

<br>

<div id="navlist2">
<ul>
  <li><a href="/investigation/{{ investigation.id }}">Overview</a></li>
  <li><a href="/investigation/{{ investigation.id }}/discussion">Discussion</a></li>
  <li><a href="/investigation/{{ investigation.id }}/timeline">Timeline</a></li>
  <li id="active"><a href="/investigation/{{ investigation.id }}/library" id="current">Library</a></li>
</ul>
</div>

</div>


<div id="middlebox">
  {% if not page %}
    <h1 class="big"">Create page</h1>
    <div class="news_box_grey">
    <form method="post" id="form" name="form" action="/investigation/{{ investigation.id }}/page/create">{% csrf_token %}
      <h2>Title</h2> <input type="text" id="title" name="title" style="width:100%;"/><br><br>
      <textarea id="wiki" class="nomceEditor" name="content"></textarea><br>
      <input type="hidden" name="action" value="create" />
      <input type="submit" value="Save" class="submit"/>
    </form>
    </div>
  {% else %}

    <h1 class="big"">{{ page.title }}</h1>
  <div class="news_box_grey">
    {{ page.content|linebreaksbr }}
          <br<br><hr>
          <div onclick="$(this).next('div.#hidetext').toggle('fast')" style="cursor:pointer;"><span class="add">Edit</span></div>
         <div id="hidetext" style="display:none;">
          <form action="/investigation/{{ investigation.id }}/page/{{ page.id }}" method="post" enctype="multipart/form-data">{% csrf_token %}
            <br>
            Title: <input type="text" name="title" value="{{ page.title }}" /> <br><br>
            <textarea id="id_description" rows="10" cols="40" name="content">
{{ page.content|linebreaks|striptags }}</textarea> <input type="submit" value="Save" /> 
          </form> 
    <br><br>
  </div>
  <div style="float:right;margin-top:-23px;">Last updated by {{ page.creator.get_full_name }} | {{ page.lastupdated|timesince }} ago</div>

  {% endif %}


</div>
  <br>

<br>

  {% if page %}

{% get_comment_count for page as comment_count %}
{% if comment_count %}
  <h2>{{ comment_count }} comments</h2>
{% endif %}

{% get_comment_list for page as comments %}
{% for comment in comments %}
    <div class="comment-container">
      <div class="comment">
          <div class="avatar"><img class="avatar-thumb" src={% thumbnail comment.user.get_profile.avatar 32x32 crop %}></div>
          <span class="threadTitle"><a href="/user/{{ comment.user.id }}">{{ comment.user.first_name }} {{ comment.user.last_name }}</a></span><br>
          <span class="threadText">{{ comment.submit_date|timesince }} ago</span><br><br>
          {{ comment.comment|linebreaksbr }}
      </div>        
    </div>        
{% endfor %}

<br>

<div class="box_color">
  <h1>Write a comment</h1>
  <br>
  {% get_comment_form for page as form %}
  <form action="/comments/post/" method="post">{% csrf_token %}
      <input type="hidden" name="next" value="/investigation/{{ investigation.id }}/page/{{ page.id }}" />
      {% for hidden in form.hidden_fields %}
        {{ hidden }}
      {% endfor %}
      {{ form.comment }}
      <br>
      <input type="submit" value="Post">
  </form>
</div>

  {% endif %}



</div>

<br clear="all">

{% endblock %}