{% extends "apps/report/base.html" %}
{% load comments %}

{% block menu %}
		<a class="normalLink" href="/">Home</a>
		<a class="normalLink" href="/investigation">Investigations (0)</a>
		|
		<a class="normalLink" href="/upload">Upload</a>
		<a class="normalLink" href="/report">Report</a>
{% endblock %}

{% block content %}

<h1>Info for {{ result.type.name }} {{ result.value }}</h1>
<hr>
<div class="box_color">
<table border=0>
	
	<tr><td><b>Value:</b></td><td>{{ result.value }}</td></tr>
	<tr><td><b>md5:</b></td><td>{{ result.md5 }}</td></tr>
	<tr><td><b>sha1:</b></td><td>{{ result.sha1 }}</td></tr>
	<tr><td><b>sha256:</b></td><td>{{ result.sha256 }}</td></tr>
</table>

{% if resultall %}
	<hr>
	<table border=0>
		<th>{% if multiple_hits %}<font color="orange">Reported by</font>{% else %}Reported by{% endif %}</th>
		<th>Value</th>
		<th>Type</th>
		<th>Date</th>
		<th>Reference</th>
		{% for n in resultall %}
			<tr >
				<td><a href="/user/{{ n.user.id }}">{{ n.user.first_name }} {{ n.user.last_name }}</a></td>
				<td>{{ n.report.value }}</td>
				<td>{{ n.report.type }}</td>
				<td>{{ n.timecreated|date:"Y-m-d h:i:s" }} ({{ n.timecreated|timesince }} ago)</td>
				{% if n.reference %}
					<td><a href="/search/reference?r={{ n.reference.id }}">{{ n.reference }}</a></td>
				{% else %}
					<td></td>
				{% endif %}
			</tr>
		{% endfor %}
	</table>
{% endif %}

	<hr>
	<b>Tags:</b> {% for tag in tags %}<i><a href="/search/tag?t={{ tag.id }}">{{ tag }}</a></i> {% endfor %}
	<form action="/tag/add/report/{{ result.id }}" method="post" enctype="multipart/form-data" width="450px">{% csrf_token %}
		{% for field in tagform %}
        	{{ field.errors }}
        	{{ field }}
        {% endfor %}
    	<input type="submit" value="Add tag" />
</form>
{% if resultme %}
	{% ifequal resultme.reference None %}
	<b>Reference:</b>
	<form action="/reference/add/report/{{ resultme.id }}" method="post" enctype="multipart/form-data" width="450px">{% csrf_token %}
		{% for field in referenceform %}
        	{{ field.errors }}
        	{{ field }}
        {% endfor %}
    	<input type="submit" value="Save" />
    </form>
    {% else %}
		<div onclick="$(this).next('div.#hidetext').toggle('fast')" style="cursor:pointer;"><b>Reference:</b> <i>{{ resultme.reference }}</i> [Edit]</div>
			<div id="hidetext" style="display:none;">
				<form action="/reference/add/report/{{ resultme.id }}" method="post" enctype="multipart/form-data" width="450px">{% csrf_token %}
					{% for field in referenceform %}
        				{{ field.errors }}
        				{{ field }}
        			{% endfor %}
    				<input type="submit" value="Save" />
    			</form>
			</div>	
			<br>
	{% endifequal %}
{% endif %}
</div>

<div class="box_color">
<h2>Write a comment</h2>
<br>
	{% get_comment_form for result as form %}
	<form action="{% comment_form_target %}" method="post">{% csrf_token %}
		<input type="hidden" name="next" value="/report/{{ result.id }}/show" />
		{% for hidden in form.hidden_fields %}
        	{{ hidden }}
    	{% endfor %}
		{{ form.comment }}
		<br>
  		<input type="submit" value="Post">
	</form>
</div>

{% get_comment_count for result as comment_count %}

{% if comment_count %}
<h2>Comments ({{ comment_count }})</h2>
<hr>
	{% get_comment_list for result as comment_list %}
	{% for comment in comment_list reversed %}
	    <div class="post_container">
	    <div class="post_box">
	    	<span class="threadTitle"><a href="/user/{{ comment.user.id }}">{{ comment.user.first_name }} {{ comment.user.last_name }}</a></span> 
			<span class="threadText">{{ comment.submit_date|timesince }} ago</span> 
	    	<br><br>
	    	{{ comment.comment|linebreaksbr }}
	    </div>
		
		{% get_comment_list for comment as subcomment_list %}
		{% for comment in subcomment_list %}
	    	<div class="subpost_container">
	    		<span class="threadTitle"><a href="/user/{{ comment.user.id }}">{{ comment.user.first_name }} {{ comment.user.last_name }}</a></span> 
				<span class="threadText">{{ comment.submit_date|timesince }} ago</span> 
	    		<br><br>
	    		{{ comment.comment|linebreaksbr }}
			</div>
		{% endfor %}
	    {% get_comment_form for comment as form %}
	    	<br>
			<div onclick="$(this).next('div.#hidetext').toggle('fast')" style="cursor:pointer;">Comment</div>
			<div id="hidetext" style="display:none;">
			<form action="{% comment_form_target %}" method="post">{% csrf_token %}
				<input type="hidden" name="next" value="/report/{{ result.id }}/show" />
				{% for hidden in form.hidden_fields %}
        			{{ hidden }}
    			{% endfor %}
				{{ form.comment }}
				<br>
  				<input type="submit" value="Post">
			</form>
	    </div>
	    </div>
	{% endfor %}
{% endif %}

{% endblock %}