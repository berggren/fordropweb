{% extends "apps/report/report_base.html" %}
{% load comments %}
{% load thumbnail %}

{% block extrahead %}
<script>
    $(document).ready(function() {
        $("#button_block").hide()
        $("#id_comment").focus(function() {
            $(this).animate({"height": "85px"}, "fast" );
            $("#button_block").slideDown("fast");
            return false;
        });
        $("#button_cancel").click(function() {
            $("#id_comment").animate({"height": "18px"}, "fast" );
            $("#button_block").slideUp("fast");
            return false;
        });
    });
    </script>
{% endblock %}

{% block report_leftside %}
<ul class="tabs">
    <li><a href="/file/{{ file.id }}/show">Info</a></li>
    <li class="active"><a href="/file/{{ file.id }}/related">Related</a></li>
    <a href="/file/{{ file.id }}/graph" class="btn info right">Graph</a>
</ul>

    <br><br><br>

    {% for file_user in people %}
        {% ifnotequal user file_user %}
        <div class="post_container">
            <div class="avatar">
                 {% thumbnail file_user.profile.avatar "40x40" crop="center" as im %}
                     <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
                 {% endthumbnail %}
             </div>

            <div class="post_box">
                <a href="/user/{{ file_user.id }}"><strong>{{ file_user.profile.name }}</strong></a>
                <br>
                {{ file_user.profile.email }}
            </div>
        </div>
        <br>
        {% endifnotequal %}
    {% endfor %}

    {% for investigation in investigations %}
        <div class="post_container">
            <div class="post_box"><strong>Investigation </strong><a href="/investigation/{{ investigation.id }}">{{ investigation.title }}</a></div>
        </div>
    {% endfor %}

    {% for file in files %}
        <div class="post_container">
            <strong>File</strong> <a href="/file/{{ file.id }}/show">{{ file.sha1 }}</a>
            <br>
            <span class="quiet">{{ file.filetype }}
            <br>
            {{ file.time_created }}
            </span>
            <br><br>
        </div>
    {% endfor %}

{% endblock %}

{% block report_rightside %}
<h4>Discussion</h4>
<!-- Comments -->
<br>
{% get_comment_list for result as comments%}
{% get_comment_form for result as form %}
<form method="post" action="/comments/post/">{% csrf_token %}
    <input type="hidden" name="next" value="/file/{{ result.id }}/related" />
        {% for hidden in form.hidden_fields %}
            {{ hidden }}
        {% endfor %}
        <textarea rows=1 id="id_comment" name="comment" placeholder="Say what you want to say .."></textarea>
        <br><br>
        <div id="button_block">
            <input type="submit" class="btn success" id="button_submit" value="Post" />
            <input type="submit" class="btn" id='button_cancel' value="Cancel" />
     </div>
</form>

{% if comments %}
    {% for comment in comments reversed %}
        <div class="comment-container">
            <div class="comment">
            <div class="avatar">
                {% thumbnail comment.user.get_profile.avatar "30x30" crop="center" as im %}
                    <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
                {% endthumbnail %}
            </div>

                <a href="/user/{{ comment.user.id }}">{{ comment.user.profile.name }}</a><br>
                <span class="quiet">{{ comment.submit_date|timesince }} ago</span><br>
                {{ comment.comment|linebreaksbr }}
                <br><br><hr>
            </div>
        </div>
    {% endfor %}
{% else %}
    <h6>No comments</h6>
{% endif %}
<!-- END comments -->

{% endblock %}