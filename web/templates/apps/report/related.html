{% extends "apps/report/report_base.html" %}
{% load comments %}
{% load thumbnail %}

{% block extrahead %}
<script>
    $(document).ready(function() {
        $("#button_block").hide()
        $("#id_comment").focus(function() {
            $(this).animate({"height": "85px"}, "fast" );
            $("#button_block").slideDown("fast");
            return false;
        });
        $("#button_cancel").click(function() {
            $("#id_comment").animate({"height": "18px"}, "fast" );
            $("#button_block").slideUp("fast");
            return false;
        });
        $("#editref").click(function() {
            $("#ref").remove();
            $(this).replaceWith("<form method='post' action='/reference/add/file/{{ resultme.id }}'> {% csrf_token %}<input class='left' style='width:310px;margin-top:3px;margin-left:10px;' type=text name='reference'></input><input type=submit value='Change' class='btn right' style='margin-top:3px;'></form>");
        });
    });
    </script>
    <!--
    <script>
    $(document).ready(function() {
        var investigation_table = '<table><th><h3>Investigations</h3></th>';
        var file_table = '<table><th><h3>Files</h3></th>';
        var people_table = '<table><th><h3>People</h3></th>';
        $.getJSON("/related?n={{ file.graph_id }}", function(data) {
            $.each(data['nodes'], function(k, v) {
                if (v['type'] == 'investigation') {
                    investigation_table += '<tr><td>'+k+'</td></tr>';
                }
                if (v['type'] == 'report') {
                    file_table += '<tr><td>'+k+'</td></tr>';
                }
                if (v['type'] == 'person') {
                    people_table += '<tr><td>'+k+'</td></tr>';
                }
            });
        $("#investigations").append(investigation_table);
        $("#files").append(file_table);
        //$("#people").append(people_table);
        });
    });
    </script>
    -->
{% endblock %}

{% block report_leftside %}
<ul class="tabs">
    <li><a href="/file/{{ file.id }}/show">Info</a></li>
    <li class="active"><a href="/file/{{ file.id }}/related">Related</a></li>
    <!-- <li><a href="/file/{{ file.id }}/graph">Graph</a></li> -->
    <li><a href="/file/{{ file.id }}/wiki">Docs</a></li>
    <a href="/file/{{ file.id }}/graph" class="btn info right">Graph</a>
</ul>

<!--
<div id="people" class="span12"></div>
<div id="investigations" class="span7"></div>
<div id="files" class="span7"></div>
-->
    <br><br><br>
    {% for file_user in people %}
        {% ifnotequal user file_user %}
        <div class="post_container">
            <div class="avatar"><img class="avatar-thumb" src="{% thumbnail file_user.get_profile.avatar 40x40 crop %}"></div>
            <div class="post_box">
                <a href="/user/{{ file_user.id }}"><strong>{{ file_user.get_full_name }}</strong></a>
                <br>
                {{ file_user.email }}
            </div>
        <br>
        </div>
        {% endifnotequal %}
    {% endfor %}

    {% for investigation in investigations %}
        <div class="post_container">
            <div class="post_box">{{ investigation.title }}</div>
        </div>
    {% endfor %}

    {% for file in files %}
        <div class="post_container">
            <strong>File</strong> <a href="/file/{{ file.id }}/show">{{ file.sha1 }}</a>
            <br>
            <span class="quiet">{{ file.filetype }}
            <br>
            {{ file.time_created }}
            </span>
            <br><br>
        </div>
    {% endfor %}

{% endblock %}

{% block report_rightside %}
<h4>Discussion</h4>
<!-- Comments -->
<br>
{% get_comment_list for result as comments%}
{% get_comment_form for result as form %}
<form method="post" action="/comments/post/">{% csrf_token %}
    <input type="hidden" name="next" value="/file/{{ result.id }}/related" />
        {% for hidden in form.hidden_fields %}
            {{ hidden }}
        {% endfor %}
        <textarea rows=1 id="id_comment" name="comment" placeholder="Say what you want to say .."></textarea>
        <br><br>
        <div id="button_block">
            <input type="submit" class="btn success" id="button_submit" value="Post" />
            <input type="submit" class="btn" id='button_cancel' value="Cancel" />
     </div>
</form>

{% if comments %}
    {% for comment in comments reversed %}
        <div class="comment-container">
            <div class="comment">
                <div class="avatar"><img class="avatar-thumb" src={% thumbnail comment.user.get_profile.avatar 32x32 crop %}></div>
                <a href="/user/{{ comment.user.id }}">{{ comment.user.first_name }} {{ comment.user.last_name }}</a><br>
                <span class="quiet">{{ comment.submit_date|timesince }} ago</span><br>
                {{ comment.comment|linebreaksbr }}
                <br><br><hr>
            </div>
        </div>
    {% endfor %}
{% else %}
    <h6>No comments</h6>
{% endif %}
<!-- END comments -->

{% endblock %}