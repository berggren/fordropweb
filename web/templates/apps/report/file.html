{% extends "apps/report/report_base.html" %}
{% load comments %}
{% load thumbnail %}

{% block report_leftside %}

{% if messages %}
    {% for message in messages %}
        <div class="alert-message warning">
            <a class="close" href="#">Ã—</a>
            <p>
                <strong>{{ message }}</strong>
            </p>
        </div>
    {% endfor %}
{% endif %}

<!--<a href="javascript: history.go(-1)" style="margin-right:10px;" class="btn left">&laquo; Back</a><h3 class="inline">{{ result.sha1 }}</h3>-->
<h3>{{ result.sha1 }}</h3>
<br>
<ul class="tabs">
    <li class="active"><a href="#">Description</a></li>
    <li><a href="#">Related</a></li>
    <li><a href="/file/{{ result.id }}/graph"">Graph</a></li>
    <li><a href="#">Printable strings</a></li>
    <li><a href="#">PEdump</a></li>
</ul>

{% if investigations %}
<div class="alert-message block-message info">
    <!-- <a class="close" href="#">&times;</a> -->
    <h3>Appears in the following investigations</h3>
    {% for investigation in investigations %}
        <a href="/investigation/{{ investigation.id }}" class="btn">{{  investigation.title }}</a>
    {% endfor %}
</div>
{% endif %}

<div class="well">
    <table border=0>
	    <tr><td><b>Type:</b></td><td>{{ result.filetype }}</td></tr>
		<tr><td><b>Size:</b></td><td>{{ result.filesize }} bytes ({{ result.filesize|filesizeformat }})</td></tr>
		<tr><td><b>md5:</b></td><td>{{ result.md5 }}</td></tr>
		<tr><td><b>sha1:</b></td><td>{{ result.sha1 }}</td></tr>
		<tr><td><b>sha256:</b></td><td>{{ result.sha256 }}</td></tr>
        <tr><td><b>MHR</b></td>
        <td>
            {% if not mhr %}
	            <a href="/file/{{ result.id }}/malware/mhr?hash={{ result.sha1 }}">Check with MHR (Malware Hash Repository)</a><br>
	        {% else %}
	            {% if mhr.donotexist %}
		            <font color="green">No match in MHR:s malware repository</font><br>
	            {% else %}
	                <font color="red">{{ mhr.percent }}% chance this file is malware according to MHR</font><br>
	            {% endif %}
            {% endif %}
        </td></tr>
    </table>
</div>

{% if resultall %}
    <div class="well">
        <table border=0>
            <th>{{ resultall|length }} reporter{{ resultall|pluralize:"s"  }}</th>
            <th>filename</th>
            <th>reference</th>
            {% for n in resultall %}
                <tr>
                    <td width="200px"><div class="avatar"><img class="avatar-thumb" src={% thumbnail n.user.get_profile.avatar 32x32 crop %}></div>
                        <span class="threadTitle"><a href="/user/{{ n.user.id }}">{{ n.user.get_full_name }}</a></span><br>
                        <span class="threadText">{{ n.timecreated|timesince }} ago</span><br><br>
                        <td>{{ n.filename }}</td>
                        {% if n.reference %}
                            <td><a href="/search/reference?r={{ n.reference.id }}">{{ n.reference }}</a></td>
                        {% else %}
                            {% if resultme %}
                                <td><button class="btn">Add</button></td>
                            {% else %}
                                <td></td>
                            {% endif %}
                        {% endif %}
                </tr>
            {% endfor %}
        </table>
{% endif %}
</div>
{% endblock %}

{% block report_rightside %}
<!-- Comments -->
{% get_comment_list for result as comments %}
{% get_comment_form for result as form %}
{% if comments %}
    <h3>Comments</h3>
    <br>
    {% for comment in comments %}
        <div class="comment-container">
            <div class="comment">
                <div class="avatar"><img class="avatar-thumb" src={% thumbnail comment.user.get_profile.avatar 32x32 crop %}></div>
                <a href="/user/{{ comment.user.id }}">{{ comment.user.first_name }} {{ comment.user.last_name }}</a><br>
                <span class="quiet">{{ comment.submit_date|timesince }} ago</span><br>
                {{ comment.comment|linebreaksbr }}
                <br><br><hr>
            </div>
        </div>
    {% endfor %}
{% else %}
    <h6>No comments</h6>
{% endif %}
<form action="/comments/post/" method="post">{% csrf_token %}
    <input type="hidden" name="next" value="/investigation/{{ investigation.id }}/discussion" />
    {% for hidden in form.hidden_fields %}
        {{ hidden }}
    {% endfor %}
    {{ form.comment }}
    <br><br>
    <input type="submit" class="btn" value="Post">
</form>
<!-- END comments -->
{% endblock %}
